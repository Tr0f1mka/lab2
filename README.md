<h1> Лабораторная работа №2 "Мини-оболочка с файловыми командами" </h1>
<hr>
<p>Оболочка для работы с файлами(просмотр, перемещение, удаление и т. д.). Были реализованы функции из модуля Easy, а также функции для работы с архивами zip и tar.gz</p>

<p>Поддерживает следующие команды:</p>
<ul>
    <li>"ls" - выводит содержимое директории </li>
    <li>"cd" - переходит в указанную директорию </li>
    <li>"cat" - выводит содержимое файла </li>
    <li>"cp" - копирует файл/директорию в назначение </li>
    <li>"mv" - переносит файл/директорию в назначение </li>
    <li>"rm" - удаляет файл/директорию </li>
    <li>"zip" - создаёт архив zip </li>
    <li>"unzip" - распаковывает архив zip в рабочую директорию </li>
    <li>"tar" - создаёт архив tar.gz </li>
    <li>"untar" - распаковывает архив tar.gz в рабочую директорию </li>
    <li>"help" - выводит справку по функциям </li>
    <li>"exit" - завершает работу программы </li>
</ul>

<p2> Структура </p2>
<pre>
    .
    ├── lab2
    │   ├── src/                               # Папка с кодом
    |       ├── music/                         # Папка с звуком
    |           ├── not_enough_perms.ogg       # Звуковое сопровождение отсутствия прав
    |           ├── rm_parent_dir_error.ogg    # Звуковое сопровождение попытки удалить родительскую дмректорию
    │       ├── __init__.py                    #
    |       ├── archive_funcs.py               # Функции для работы с архивами
    │       ├── config.py                      # Конфигурация для логера
    │       ├── format_funcs.py                # Функции, форматирующие файлы/каталоги(копирование, перемещение, удаление)
    │       ├── main.py                        # Точка входа
    |       ├── my_exceptions.py               # Мои исключения
    │       ├── patterns.py                    # Шаблоны
    |       ├── read_funcs.py                  # Функции, читающие файлы/каталоги, а также функция перехода
    │       ├── tools.py                       # Функции обработок
    │   ├── tests/                             # Юниттесы
    |       ├── __init__.py                    #
    │       ├── test_cat.py                    # Тест функции cat
    │       ├── test_cd.py                     # Тест функции cd
    │       ├── test_check_flags.py            # Тест функции check_flags
    │       ├── test_check_paths.py            # Тест функции check_paths
    │       ├── test_cp.py                     # Тест функции cp
    │       ├── test_create_log.py             # Тест функции create log
    │       ├── test_ls.py                     # Тест функции ls
    │       ├── test_make_archive.py           # Тест функции make_archive
    │       ├── test_mv.py                     # Тест функции mv
    │       ├── test_normalization_path.py     # Тест функции normalization_path
    │       ├── test_parser.py                 # Тест функции parser
    │       ├── test_rm.py                     # Тест функции rm
    │       ├── test_unpack_archive.py         # Тест функции unpack_archive
    │   ├── .gitignore                         # Файл, который не даёт мусорить в гите
    │   ├── .pre-commit-config.yaml            # Конфигурация любимого pre-commit
    |   ├── poetry.lock                        # Зависимости poetry
    |   ├── pyproject.toml                     # Информация по проекту(для системы)
    |   ├── README.md                          # Документация
    │   ├── requirements.txt                   # Зависимости проекта
    |   ├── uv.lock                            # зависимости проекта
</pre>

<h2> Описание модулей </h2>
<ul>
     <li>main.py - входная точка программы. Содержит функции вывода сообщений, через неё пользователь взаимодействует с программой </li>
     <li>tools.py - модуль, который содержит функции нормализации путей, проверки флагов и путей, обработки ошибок и парсера </li>
     <li>read_funcs.py - модуль с функциями ls, cd, cat </li>
     <li>format_funcs.py - модуль с функциями cp, mv, rm </li>
     <li>archive_funcs.py - модуль с функциями make_archive, unpack_archive </li>
     <li>patterns.py - содержит шаблоны регулярных выражений для остальных модулей. </li>
     <li>my_exceptions.py - содержит кастомные исключения </li>
</ul>

<h2> Алгоритм ls </h2>
    <p>Переход в текущую рабочую директорию. Проверки на корректность флагов и путей, при отсутствии путей - используем путь к текущей рабочей директории. Затем вывод содержимого директорий: если есть флаг - получение размера, времени последнего изменения и прав файлов/директорий, затем вывод их вместе с названиями, иначе вывод только названий файлов/директорий. Ошибки и логи обрабатываются через декоратор create_log.</p>

<h2> Алгоритм cd </h2>
    <p>Переход в текущую рабочую директорию. Проверки на корректность флагов и путей. Переход в назначение. Ошибки и логи обрабатываются через декоратор create_log.</p>

<h2> Алгоритм cat </h2>
    <p>Переход в текущую рабочую директорию. Проверки на корректность флагов и путей. Вывод содержимого файла(-ов). Ошибки и логи обрабатываются через декоратор create_log.</p>

<h2> Алгоритм cp </h2>
    <p>Переход в текущую рабочую директорию. Проверки на корректность флагов и путей. К назначению в конец дописывается название источника при его отсутствии. Затем копирование файла или директории(согр=ласно флагу) в назначение. Ошибки и логи обрабатываются через декоратор create_log.</p>

<h2> Алгоритм mv </h2>
    <p>Переход в текущую рабочую директорию. Проверки на корректность флагов и путей. Перенос источника в назначение. Ошибки и логи обрабатываются через декоратор create_log.</p>

<h2> Алгоритм rm </h2>
    <p>Переход в текущую рабочую директорию. Проверки на корректность флагов и путей. При отсутствии флага удаление файла или пустой директории. При наличии флага - удаление не корневой или родительской директории. При попытке удалить родительскую директорию <strong>звучит</strong> уведомление об ошибке. Удаление происходит с разрешения пользователя. Ошибки и логи обрабатываются через декоратор create_log.</p>

<h2> Алгоритм make_archive </h2>
    <p>Переход в текущую рабочую директорию. Проверки на корректность флагов и путей. Архивация источника в назначение. Ошибки и логи обрабатываются через декоратор create_log.</p>

<h2> Алгоритм unpack_archive </h2>
    <p>Переход в текущую рабочую директорию. Проверки на корректность флагов и путей. Разархивация источника в текущую рабочую директорию. Ошибки и логи обрабатываются через декоратор create_log.</p>

<h2> Алгоритм permissions </h2>
    <p>По числу, полученному в аргументе с помощью библиотеки stat, а затем по функциям из неё же, перевод прав в буквенный вид.</p>

<h2> Алгоритм parser </h2>
    <p>Создание списка из 2 пустых списков: список путей и список флага. Парсинг строки по шаблону и обработка токенов: путь с кавычками - отсечение кавычек и добавление в список путей, пробельный символ - пропуск, флаг - добавление в список флагов, остальное в список путей. Обработка флагов: сборка единого флага из уникальных букв(итоговый флаг без "-").</p>

<h2> Алгоритм normalization_path </h2>
    <p>Замена разделителей на "/", удаление повторных разделителей. Нормализация пути. Если текущая ОС - Windows, и путь оканчивается на ":" - добавляем "\" в конец</p>

<h2> Алгоритм user_input </h2>
    <p>Ввод пользователя с цветами. Очистка цвета. Запись ввода в лог-файл.</p>

<h2> Алгоритм create_log </h2>
    <p>Запись вызова функции в лог-файл. Попытка выполнить декорируемую функцию, в случае успеха - возврат результата выполнения функции, в случае провала - вывод сообщения об ошибке в консоль, возврат пути текущей рабочей директории При ошибке нехватки прав <strong>звучит</strong> уведомление об ошибке. Запись результата(успешного или неудачного) в лог-файл. Лог-файл имеет название debug.log и хранится в корне программы. Максимальный размер лог-файлов - 3 файла по 5 МБ, при превышении этих размеров - удаление самого старого лог-файла.</p>

<h2> Алгоритм check_flags </h2>
    <p>Проход по символам флага. Если буква не встречается в контрольном флаге(состоит из всех флагов функции, в которой вызывается) - вызов исключения неизвестного флага.</p>

<h2> Алгоритм check_paths </h2>
    <p>Получение длины списка путей. Ветвление по режимам: "-2",
    "-2", "0", и "числа больше 0":
    <ul>
        <li> Режим "-2": проверка, что путей 1-2. Если путей 2 - нормализация обоих, если путь 1 - нормализация и дублирование имеющегося. </li>
        <li> Режим "-1": проверка, что путей от 1 до бесконечности. Нормализация путей. </li>
        <li> Режим "0": проверка, что путей от 0 до бесконечности. Нормализация путей. </li>
        <li> Режим "больше 0": проверка, что путей столько, сколько указано. Нормализация путей. </li>
    </ul>
    В случае отсутствия/нехватки/избытка путей(для соответствующего режима) - вызов соответствующего исключения.
    </p>

<h2> Новые исключения </h2>
    <ul>
        <li> UndefinedFlagError - исключение неизвестного флага. Вызывается в функции check_flags. </li>
        <li> TooFewPathsError - исключение нехватки путей. Имеет метод __str__, который возвращает аргумент исключения, с которым оно вызывалось. Вызывается в функции check_paths. </li>
        <li> TooManyPathsError - исключение избытка путей. Вызывается в функции check_paths. </li>
        <li> LessRFlagError - исключение отсутствия флага рекурсивного вызова. Вызывается в функциях cp и rm. </li>
    </ul>
